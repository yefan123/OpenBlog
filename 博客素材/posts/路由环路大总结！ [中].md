三。RIP的5种防环机制：

       Rip作为一个古老的路由协议，虽然正逐渐被淘汰，还是有必要了解一番以理解路由协议的进化史。

       ！！视角：仅限于自身。rip没有邻居表，不知道邻居的信息，也没有下一跳。

rip的局限性造致它有5种防环机制，且5种机制默认同时工作！！！

       先谈一个易理解的的程序员逻辑，即路由器接从F0接口收到的某个路由条目A不应该从F0反发出去（水平分割），但是距离矢量路由协议的路由更新要向外发送完整的路由表，因此从F0发出之前将A路由的度量值改为15，这样对方收到的A的度量值为16不可达（计数最大跳&毒性逆转）。

       当路由器R1检测到某网段的网络故障（比如收到icmp报错），它将要做两件事，第一，告诉其他路由器："你们无法从我这里到达这个子网"，第二，寻找其他路径到达这个子网。此时R1将抑制定时器，即在规定时间内不接收邻居发来的关于该子网的路由。试想若没有抑制定时器，这时邻居正好发送该子网的路由，而这条路径恰好经过R1，那么后果将不堪设想。

       在抑制时间内R1在做什么呢？当然是等待rip网络中所有路由器都收到这条16跳的路由后更正自己的路由表，因此需要触发更新，不必等时间到期再发路由表。此外当某接口的度量值被改动了也会触发更新，防环原理相同。

       可以看出rip的5个防环机制中，设置最大跳才是终极武器，它配合抑制定时器，不仅能解决"单链路环路"，更能防止"跨结点环路"。

 

四。EIGRP与DUAL算法:

视角：周围可视/局部视角。

Eigrp的进步之处在于多了两张表：邻居表与拓扑表。

       邻居表的建立直接避免了单链路环路：当在收到的路由更新中看到下一跳是自己，那没得说了，这条更新定是来源于我的，拒收。

       Eigrp的核心算法叫DUAL（弥散更新），其中有一条公式专门用来防止跨结点环路：当邻居通向一个网络的报告距离(RD)比本地路由器通向同一个目的网络的可行距离（FD）短时，即符合了可行性条件(FC)，该路径被写进拓扑表。但这样的算法可想而知也是有缺陷的，即很多高开销的可行备份路径也会被当做"环路"而拒绝收录。

！有一个特例：手动汇总导致的环路。

       其实汇总本身是有"缺陷"的，当路由器把汇总的主类网路由更新传给对端时就相当于让对端生成了一些关于那些"不存在"的子类网路由指向自己。这样就不合理了，如果该路由器有一个默认路由指向对端的话，环路就形成了，一个以不存在的子网ip为目的地址的恶意数据包就会在两个路由器之间无限循环，直到跳数寿命终结。

       解决方法（默认开启）是利用null0接口。本地生成的汇总路由指向这个逻辑空接口，这里要提一下路由查询的先后顺序：收到数据包先查看普通的单播路由条目，再查看本地汇总路由条目，最后才看默认路由。如图，这样就可以识别出那些数据包是恶意数据包，并且从null0口丢弃。

![这里写图片描述](https://image-store.slidesharecdn.com/fa6ac6dd-886a-45f0-916a-acf21fc87d60-original.png)