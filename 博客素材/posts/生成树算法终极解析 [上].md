>也是两年前大一写的,现把它博客搬家过来...

许多老师讲一个新协议时，总会“强制性”地给你灌输它的各种规则，导致许多学生死记硬背之后任然一脸懵逼。我当初听stp时 也是遗留了很多问题：比如为什么这么设计；这种机制为什么不能这样改进；如果这么这么的话，会怎么怎么样。太多的不理解导致我的记忆效率大大降低。所以我 希望可以从一个协议的起源，开发的目地，设计师的想法（框架），分类分层地来叙述一种优秀的机制，并且提出它的局限性。

![这里写图片描述](http://s3.sinaimg.cn/large/00688cvOzy730LIk8vM92&690)



这是一个纯交换层网络的拓扑图（先不考虑主机）。

此拓扑图表面上是一个物理图，但它可以包含许多逻辑无环图。（即pvst，稍后会讲）

（每个交换机上都可以连若干个PC，任意两个PC之间通讯都经过其中的某条路径。）

（请读者学习生成树逻辑时都把想象建立在一张足够大的拓扑图上，因为深刻的理解是基于实用性而产生的而不要死记它的机制）

生成树协议stp（spanning tree protocol）是工作在交换层交换机上的一种防环机制（！！！！！！同时提供冗余）。交换机路径的备份使得环路的出现。因为交换层相对网络层规模较小，才允许广播的存在。（路由器分割广播域而交换机不能）（广播加上环路才形成了广播风暴，因而网络层虽有环路但不需要生成树）

    建议拿pt模拟器做试验。快速生成树协议rstp（rapid spanning tree protocol）较stp优越些。因rstp与stp机制基本相似，且交换机默认开启rstp，本章重点研究rstp。

众所周知顾名思义，一棵物理树的树枝是不会形成环路的，因此一棵生成树的根桥（根网桥，交换机的前身）就是物理树的根节点，非根桥就是物理树的分支点或者树枝末端。以及之后的trunk link（树干链路）模式，他们都是可类比的。某个vlan（记作vlan x），所有开启了vlan x的交换机（且这些交换机相连）构成了一棵关于vlan x的生成树。

！！生成树的原理：在众多交换机中选择一个作为根桥，其余在每个交换机上选择唯一的一条路径通向根桥，再将剩下不用的路径（链路）堵塞。

！！生成树机制的目的：让二层交换机通电相连后在很短时间内自动收敛出一棵或多棵生成树。（这是stp的精髓所在）

![这里写图片描述](http://s1.sinaimg.cn/large/00688cvOzy730ZrbMbuc0&690)

    