> ####作为一个新手(并不是菜鸟,而是像我们这样的学生),维护一个网站往往是一个很头疼的问题,尤其是动态网站,更尤其是用java写的网站.
> ####当网站的吞吐量很小的时候你会发现服务器根本不需要维护,因为几乎没有延迟宕机等bug出现,但是当你的网站源代码达到10M以上时你就要小心了,你的网站随时会崩溃,即使没有ddos.
> ####虽然不是专业的服务器维护人员也不是专业的算法工程师,但是我根据经验总结出了一下几个思路,可以很有效的提高你的网站的可用性.

##数据库篇
数据库是影响网站可用性的最重要的因素,70%以上的小型网站的宕机问题都是由于数据库崩溃造成的,怎么做呢?
###使用连接池
数据库连接池类似tcp连接,需要消耗时空资源来建立,维护,销毁一个连接,再使用它,但是数据库的访问是位于web服务器架构最底层的dao层,可以说和用户之间没有任何直接联系,而且数据库多连接的初衷是多个数据库访问之间相互隔离,互不干扰,以达到安全的目录,但是对于一个网站整体来说,内部的对象和方法都是相互信任的,甚至可以共享一个数据库连接.
这时候我们还需要为每一个请求,每一个服务,每一个方法维护一个数据库连接对象吗?显然是浪费生命.

>数据库连接池负责分配、管理和释放数据库连接，它允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个；释放空闲时间超过最大空闲时间的数据库连接来避免因为没有释放数据库连接而引起的数据库连接遗漏。这项技术能明显提高对数据库操作的性能。

市场上基于java的开源连接池有dbcp,c3p0等比较主流,还有hibernete框架提供了封装好的连接池方法可以使用.
###抛弃数据库
##服务器缓存
即使建立 了数据库连接池,只是节省了数据库连接的开销,但是数据库还是要经受住大量的并发访问.但是为每一个动态网页访问一次数据库真的必要吗??
对于某些实时更新的网站比如某某股票走势图,那实时访问数据库是必须的,但是对于一个相对更静态的网页来说,比如我这个个人博客,里面的文章几乎是几天一更,这个时候就完全没必要浪费数据库资源了,甚至可以把动态网页(jsp)直接重写成静态的(html)文件给用户看,效果是一样的.
但是重写太鲁莽了,我们要做的是缓存以达到更弹性的效果.
经过上面一讲,大家对服务器缓存肯定没有疑惑了,它就是实现了一种对用户透明的一种优化机制,直接上产品吧,在java市场,web缓存发展的还不是很快,但一个主流的产品是OSCACHE,有以下特点:'

> 缓存任何对象，你可以不受限制的缓存部分jsp页面或HTTP请求，任何java对象都可以缓存。 拥有全面的API--OSCache
> API给你全面的程序来控制所有的OSCache特性。
> 永久缓存--缓存能随意的写入硬盘，因此允许昂贵的创建（expensive-to-create）数据来保持缓存，甚至能让应用重启。
> 支持集群--集群缓存数据能被单个的进行参数配置，不需要修改代码。
> 缓存记录的过期--你可以有最大限度的控制缓存对象的过期，包括可插入式的刷新策略（如果默认性能不需要时）


"当然了,也可以自己手写"


##浏览器缓存
为啥很多人选择关掉browser缓存啊,这明明是有利于双方的优良机制啊,又不是web前端人员嫉cache如仇..
不过缓存真的对小型服务器很友好,尤其是我们这些在阿里云腾讯云上租的廉价学生机,只有可怜如两三兆的出口带宽,不开启浏览器缓存的话真的是浪费钱,最好把超时时间弄长一点,24小时最好,java代码如下:

> //设置浏览器缓存30分钟
>  resp.setHeader("Cache-Control", "public");  
> resp.setHeader("Pragma", "Pragma");   
> resp.setDateHeader("expires",new Date().getTime()+30*60*1000);  


##服务器代理
和服务器缓存不一样,代理类似过滤器,但是最好是在新的机器上部署,比如防火墙,好吧,做代理的效果其实就是升级硬件的效果,不过这是一种任务分离的思想,可以显著提高响应速度,亲测有效!
##容器篇
###定期重启
即使JVM的垃圾回收机制再好,总会有残留的内存垃圾,有的是由bug产生的,也有非bug产生的,但是无论如何,建过网站的小伙伴们都有感受,把服务器重启一番,或者把服务器软件重启一下,整个网站神清气爽,速度刷新.所以有了这个思路,也不必纠结于人生三大错觉之一的"我能管理好内存"了,重启大法好!
对于linux系统,可以利用crond命令来自动的周期性的重启服务器容器(tomcat):

> crontab -e 0 0 * * * /usr/local/tomcat/bin/shutdown.sh >>
> /root/reboot_tomcat_log 2>&1 1 0 * * *
> /usr/local/tomcat/bin/startup.sh >> /root/reboot_tomcat_log 2>&1
> crontab -l  systemctl restart crond

##技巧篇
###能放在客户端计算的任务统统放!
永远不要怀疑JavaScript的计算能力,至少我认为JS的地位是不逊于java的.扯远了,什么叫"能放在客户端计算的任务统统都放"呢?就是说有些对于原始数据的处理任务没必要我们服务器端算好了再把上层数据交到浏览器那边显示,什么是原始数据?什么是上层数据?,举几个很简单的栗子:
- 用户想要查看某小组中所有成员的排名信息,GET包发给我们以后,我们真的要给他排好名再返回给它一个列表吗,很显然这是愚蠢的,我们只需要从数据库中提取出并发出这些成员信息给那个用户,让他在浏览器端执行排名操作,最后显示出来.
- 再比如,这个用户又想要"搜索某博主的某篇文章",我们真的要为了他进行一次全表扫描吗?impossible,我们都知道检索任务是非常消耗cpu资源的,如果每个人都来扫一遍,服务器肯定崩溃,因此,移至客户端!将原始数据(所有文章的标题)通过ajax给浏览器就行了,或者很多情况客户端已经获得了部分文章标题,ajax只要索要剩下的部分就行,然后计算检索,显示.

这是一种优秀的优化的思路或者说运维的素养.

###将静态资源偷偷移植到第三方平台
什么意思呢?对于我们这种尴尬的学生党,买的vps的出口带宽真的很少,基本上1M 1.5M的都有,最多加到3M就吃不消了,同时内存更贵,基本上都买1G的,当然了土豪随意,如果网页里面许多张少则几百k,多则上兆的图片一放,几个用户一访问,容器分分钟原地爆炸,这就很尴尬了,是你的技术不行吗?不是,而是服务器的配置还特么没我的个人电脑配置高(我的笔记本4核16G),这还怎么玩儿...
所以,我们可以借助其他平台来存放我们这些图片啦,视频啦,甚至css等文件,然后通过url取得.像这些第三方平台太多了,就拿云相册服务来说,网易,新浪,BAT,等等等等,数不胜数的其他平台都可以免费上传照片.
要注意的是,对于一些比较严格的平台,你需要做的是修改http头部,把它伪装成一个正常的浏览器访问包,不然这些url可能返回错误的数据,比如新浪博客的图片会返回"此图片仅供新浪内部用户使用";网易lofter会直接返回一个403.