![](https://image-store.slidesharecdn.com/0887a4b6-887a-4a50-b69c-7204d2960c79-original.jpeg)

如图，我想采用一种全新的“框架式”教学法，或者叫“盖楼”，旨在利用抽象的外部接口，分类分层地介绍各个机制之间的关系。其实任何学习到最后都是这个样子，比如数学，刚开始你要认识各种数学定理并且证明他们，之后你就能灵活运用这些定理去解决更高层的问题，而不用再去思考那些定理的证明方法，实现“屏蔽底层的复杂度”。如果你学完一个系统的逻辑机制后仍然在担心，会不会发生某一种情况让这个系统故障？呵呵，那只能说你是死记硬背的。

EIGRP是极少数的几个思科私有协议之一，在时间顺序上介于RIP与OSPF之间。EIGRP本是一款优秀高效的动态路由协议，但它的现状却不乐观：，由于现实因素，全球的园区网、骨干网领域基本上被OSPF，IS-IS和再上面的BGP给垄断了，只剩下地球角落里的一点点企业仍然在使用它。

不得不说EIGRP有点可怜，因为它本身有着其他协议无法比拟的优点：

1.隶属于高级距离矢量协议（其实是高于）。它由距离矢量和链路状态两种路由协议混合而成：既像前者那样，与它的邻居交换更新信息；也像后者那样，保存着一个拓扑表。

2.网络收敛速度于所有协议中最快，出动查询同时保存备份路径，主链路断掉后备份立刻顶上。

3.能保证99.99%无环路，依赖于可爱的DUAL算法。

4.支持不等价负载均衡。

下面正式进入EIGRP原理的系统大厦：

首先，进化自RIP的EIGRP依然是通过“口口相传”的形式了解到去往每个网段的最佳邻居。注意，这里的寻路原理类似生成树但不同于ospf，与前者的唯一不同在于，一个是线与线之间一个是点到点之间的寻路，而后者是在整个网络的“线路图”中通过dijkstra算法求得最短路径，也就是地图导航中使用的算法。这些区别一定要弄清楚。

然后提到视角问题。EIGRP开创了“发现邻居”的先河，保留了一份前无古人的邻居表。邻居表中存放着与自己形成邻接关系的邻居，提醒一下，邻居就是物理位置上相邻而邻接指同属一个eigrp域。如果说RIP的视角只局限于每个路由器自身，那么EIGRP的视力可以看到周围所有的邻居设备，从而增强了网络的可靠性和安全性。

视角范围的大大提升（当然OSPF拥有更大的视角）直接避免了RIP难以避免的“很愚蠢”的环路，即一条链路两端永不停息的来回交换着同一个数据包，就像两个邻居在赌气一般。因为如果在某个网络的更新包中看到邻居的下一跳竟是自己，那么果断扔掉（类比BGP的AS号）。除此之外，EIGRP自己的水品分割和DUAL算法也给这种环路宣告了死刑。

说到邻居，自然就引入了hello消息。hello消息的三个（也可以是两个）作用是发现、建立和维护邻居关系。由于需要间隔性的维护，hello消息自始至终都一直存在着，占用着一点带宽。邻居关系的维护构成了EIGRP最底层的独立机制，之所以叫独立是因为其与上面的其他机制互不影响（除非关系中断）。所以，学会了hello包之后再学习网络收敛机制就不用考虑hello的工作原理了，更不用担心hello机制的影响让上层机制产生bug！

EIGRP里面的所有机制包括底层机制，他们正常工作的根本前提是EIGRP程序本身完好无损！！之后提到的环路、短路、次优等bug都是EIGRP程序（机制）造成的，而如果程序本身被串改或染上病毒，那么就不是改善机制所能解决的了。针对这个问题，一个思科内部员工建议，通过思科路由器的操作系统（IOS）来监控这个可能出现的bug，一旦发现则禁用EIGRP，并且向邻居发送一个goodbye消息，意指“我已经挂了”。这是个开创性的发明，那个提出者也获得了百万美金，如果说EIGRP是一款软件，那么goodbye则是一个游离在应用软件与操作系统之间的“高权限”程序。

接下来到了EIGRP的精髓。EIGRP的下一张表是拓扑表。拓扑表是最重要的一张表，它是EIGRP核心算法DUAL的数据库，就好比cpu与内存的关系。拓扑表中存放着所有邻居发来的路有信息，注意，拓扑表中所有条目最好按照不同的目标网络来分类而不是按照不同的邻居，即抵达同一个目的地的所有路径的唯一区别是拥有不同的下一跳，这样有利于理解之后的选路机制。 

   