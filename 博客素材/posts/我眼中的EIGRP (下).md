DUAL（弥散更新算法）中的防环核心公式是：FC=(AD

细心的同学会发现，这个公式是有瑕疵的。在默认情况下（即不做任何修改的情况），局域网中的环路都将被避免。与此同时，有些开销足够大的非环路次优路径因为不满足FC公式而被排出备份路径。

针对这个问题，思科提供了两种解决方案。第一种，利用EIGRP自身的查询机制，当拓扑表中没有备份路径而此时主路径失效后，路由器会主动向邻居发送查询消息，这时那些曾经被“看不起”的次优路径就会被高度重视，变成最佳路径。第二种，手动修改度量值参数（即使连路两段度量值不一样也不影响邻接关系）使总度量值满足公式，这是目前最完美的解决方案，因为它从根源上解决问题，避免了“为了debug衍生出新bug”的尴尬。

再然后到了EIGRP的故障倒换机制，也是EIGRP独一无二的地方。大家研究故障倒换一定要养成“钻牛角尖”的习惯，虽然学IT最忌讳走极端，但是他是不包含网络安全这个领域的。好，在各种想象的应用场景中，只要是链路就将它幻化成含有二层交换机的多分支网段，只要是一个部门网段就让他有多个网关路由器。

时间顺序上，当一个网段或其中一根链路出现故障后，相关的路由器就会立刻知道并且从拓扑表中搜寻有无备份路径，如果没有则被触发一个错误报告（路由更新）给所有的邻居“从我这里无法到达这个网络”，同时再向所有邻居发送一个查询消息以查找可到这个网络的邻居。收到报错包的路由器自然认为这条路径已断，然后选择备份或者发送查询。

不知是否发现，这个查询机制又带来一个问题：FC本来就是为了避免环路才排除那些路径，现在查询机制又直接接受那些路径，如果她们真的是环路该怎么办？答案是：这种情况在现实生活中很少出现，通常全互联的企业网络就已经将环路路径远远甩在备份路径的考虑之后，也就是说通常备份路径是足够多的。如果极端情况，也就是变态的网络规划下出现了这个环路，那不好意思，只能人为的去避免环路，比如利用stub和ACL。

然后问题又来了：那这个查询机制还有个卵用？！哎，怎么说呢，送给大家一个哲学吧：程序员并不聪明，大多数情况只会按部就班按照人类的逻辑开发程序，有时也会把生活中的一些错误习惯带到协议中，因为过于追求算法的完美和精炼的代价是消耗算法的逻辑框架，虽然节省了网络开销但不利于人的学习思考也不能带来等价的商业价值。

更有甚者,有些知识点，比如不等价负载均衡的值，是个CCIE一眼就能看出其设计的很不尽人意，完全可以用更简单的方式表达,但思科非要这么做,故意将其复杂化，让外行人（比如客户）看不懂以体现其技术的深奥！路由器交换机配置的命令行完全可以通过图形化界面代替，鼠标点点选选就可以完成的配置非要设计的像编程一样枯燥难懂，思科早年也提出过这样的概念但是居然被整个行业一票否决…无奈之余我只能将之看成是行业的恶性保护以及标准化的潜规则。试想，当人人都轻而易举学会图形化的网络配置，购买一款人性化软件就能解决所有网络问题，那还要我们CCIE做什么？！不知道大家听明白了没?。。

既然提到了,就顺便说说不等价负载均衡吧.有一个知识点原来困惑了我很久,后来才发现就是个笑话,那就是不等价负载均衡值的计算公式=[FD/FDmin]

1(向下取整再加一,也就是向上取整).后来看到不负均的省查条件里有一句话叫:不等价负载均衡值乘以FDmin必须大于次有路径的FD.我想了半天想不明白,最后在草稿纸上重新推导了一遍这个公式发现,原来这句话已经由前面的计算公式决定了!一句废话为啥还要写在上面啊,再说这个值本来也没什么用!哎说了这么多我也不需要再说什么了.

很多初学者抱怨说,不仅不负均值是个鸡肋,它本身也无法根据特定网络筛选实际需要均衡负载的路径.前者我认同but后者其实可以灵活调整因为你忽略了它的一个审查条件,就是要满足坑爹的FC——那个配合查询机制一起防环的战斗鸡肋.你可以手动或用偏移列表修改路径度量值让不想负载的路径被排除在外即可,也可用不负均值来筛选稍麻烦一点.

吐槽了这么多EIGRP的缺点,最后还是回到主题吧,谈谈网络的层次化架构.虽然ospf和is-is将之发扬光大,但eigrp作为”口口相传路由协议”的代表利用汇总也可以实现层次化、部门化（区域化）的设计:核心层连接不同部门，以部门为单位的局域网各自在同一个大的主类网或子类网中,部门边界做汇总送给核心层,从而有效提高了网络的规划管理能力和对故障的防御力.

网络层次化架构也映射了文章开头提到的学习方法——框架式学习.虽然随着文章的深入这栋大楼不知倒了多少层,但仍然希望它依旧不影响作者和读者的热情.本文没有具体的参数,只有满满的逻辑,因为我的初衷是献给大家一个全新的看待问题的角度,希望大家能理解它,不理解也没关系,这种奇葩的视角本来就无法普及.总之要想全面了解EIGRP的具体参数和更详细的原理如关于三张表四条公式五个消息的还请扭正三观并transfer

to正版书籍~