一。前言：

       "人类的创造力与破坏力同样强大"。互联网行业尤其是网络构建这一领域，从根本上一直存在着一个无奈之处：网络本可以设计的很简单，只要实现网络的连通性即可，甚至全互联，但就是因为要fight against"天灾人祸"，尤其是人祸，互联网才衍生出了纷繁复杂的路由协议和各种因特网服务，以及"网络安全"这个庞大的领域。这也是为什么说当今所有的网络通讯流量中，80%的资源都被浪费（用于承载路由消息，协议字段等信息），只有20%被用以有效数据的传输。

 

防环机制就是在这样一个大背景下产生的。

       环路出现在互联网的各个层面，不同环路的出现原因与解决方法也不同。通常网络环路分为第二层环路和第三层环路，所有环路的形成都是由目的路径不明确导致混乱而造成的。二层环路主要就是交换机广播流的恶性循环。

       三层环路就复杂多了，通常由各种网络故障导致！！！也是本文研究的重点。笔者将三层环路分成三类：单链路环路、跨结点环路、区域/AS间环路。

 

二。交换层广播流与生成树：

       众所周知，交换网络是一个小型的本地接入网（LAN），所以二层交换机默认允许转发广播流（路由器则默认丢弃）。除了广播流，交换机查询mac地址表无果时会将数据帧从除接收接口外的所有接口发送出去。

       所以最初，当三个交换机两两相连时，一个数据帧会在其中无限循环。生成树就是为了让交换网络中防环而出现的。由于具体的生成树工作原理过于复杂需另成文，在此只做介绍不做详解。

       生成树最原始的版本是802.1d，也就是STP（Spanning Tree Protocol），但这个版本的标准是所有VLAN共用一个生成树，所以也叫CST（Common Spanning Tree）思科在此基础上增强了一下，发布了PVST+（Per Vlan Spanning Tree）。

       802.1d的下一个版本是802.1w，也就是RSTP（Rapid STP），但还是共用生成树，搞不懂IEEE不长点记性。于是思科又搞了一下，发布了PVRST+。


  ![这里写图片描述](https://image-store.slidesharecdn.com/8e7acfa5-2c31-472d-9cee-c556a77a1c32-original.jpeg)